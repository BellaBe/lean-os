# Internationalization (i18n)

## Setup with next-intl

```bash
npm install next-intl
```

### Project Structure

```
app/
├─ [locale]/
│   ├─ layout.tsx
│   ├─ page.tsx
│   └─ products/
│       └─ page.tsx
├─ api/
messages/
├─ en.json
├─ es.json
└─ fr.json
middleware.ts
i18n/
├─ request.ts
└─ routing.ts
```

### Configuration

```ts
// i18n/routing.ts
import { defineRouting } from 'next-intl/routing';

export const routing = defineRouting({
  locales: ['en', 'es', 'fr'],
  defaultLocale: 'en',
  localePrefix: 'as-needed',  // Only show prefix for non-default
});

export type Locale = (typeof routing.locales)[number];
```

```ts
// i18n/request.ts
import { getRequestConfig } from 'next-intl/server';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;
  
  if (!locale || !routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  };
});
```

```ts
// middleware.ts
import createMiddleware from 'next-intl/middleware';
import { routing } from './i18n/routing';

export default createMiddleware(routing);

export const config = {
  matcher: ['/', '/(en|es|fr)/:path*'],
};
```

```ts
// next.config.ts
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./i18n/request.ts');

export default withNextIntl(nextConfig);
```

### Layout Setup

```tsx
// app/[locale]/layout.tsx
import { notFound } from 'next/navigation';
import { NextIntlClientProvider } from 'next-intl';
import { getMessages } from 'next-intl/server';
import { routing } from '@/i18n/routing';

export function generateStaticParams() {
  return routing.locales.map(locale => ({ locale }));
}

export default async function LocaleLayout({
  children,
  params: { locale },
}: {
  children: React.ReactNode;
  params: { locale: string };
}) {
  if (!routing.locales.includes(locale as any)) {
    notFound();
  }

  const messages = await getMessages();

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

## Message Files

### Structure

```json
// messages/en.json
{
  "common": {
    "loading": "Loading...",
    "error": "Something went wrong",
    "save": "Save",
    "cancel": "Cancel"
  },
  "nav": {
    "home": "Home",
    "products": "Products",
    "about": "About"
  },
  "products": {
    "title": "Our Products",
    "addToCart": "Add to Cart",
    "outOfStock": "Out of Stock",
    "price": "Price: {price}",
    "itemCount": "{count, plural, =0 {No items} =1 {1 item} other {# items}}"
  },
  "auth": {
    "login": "Log in",
    "logout": "Log out",
    "welcome": "Welcome, {name}!"
  }
}
```

```json
// messages/es.json
{
  "common": {
    "loading": "Cargando...",
    "error": "Algo salió mal",
    "save": "Guardar",
    "cancel": "Cancelar"
  },
  "nav": {
    "home": "Inicio",
    "products": "Productos",
    "about": "Nosotros"
  },
  "products": {
    "title": "Nuestros Productos",
    "addToCart": "Añadir al Carrito",
    "outOfStock": "Agotado",
    "price": "Precio: {price}",
    "itemCount": "{count, plural, =0 {Sin artículos} =1 {1 artículo} other {# artículos}}"
  },
  "auth": {
    "login": "Iniciar sesión",
    "logout": "Cerrar sesión",
    "welcome": "¡Bienvenido, {name}!"
  }
}
```

## Usage Patterns

### Server Components

```tsx
// app/[locale]/products/page.tsx
import { getTranslations } from 'next-intl/server';

export async function generateMetadata({ params: { locale } }: Props) {
  const t = await getTranslations({ locale, namespace: 'products' });
  return { title: t('title') };
}

export default async function ProductsPage() {
  const t = await getTranslations('products');
  const products = await getProducts();

  return (
    <div>
      <h1>{t('title')}</h1>
      {products.map(product => (
        <ProductCard
          key={product.id}
          product={product}
          addToCartLabel={t('addToCart')}
        />
      ))}
    </div>
  );
}
```

### Client Components

```tsx
"use client";
import { useTranslations } from 'next-intl';

export function AddToCartButton({ productId }: { productId: string }) {
  const t = useTranslations('products');
  const [pending, setPending] = useState(false);

  return (
    <button onClick={() => addToCart(productId)} disabled={pending}>
      {pending ? t('common.loading') : t('addToCart')}
    </button>
  );
}
```

### Interpolation & Plurals

```tsx
// Simple interpolation
t('auth.welcome', { name: user.name })
// → "Welcome, John!"

// Price formatting
t('products.price', { price: formatCurrency(product.price, locale) })
// → "Price: $29.99"

// Pluralization
t('products.itemCount', { count: cart.items.length })
// → "3 items" / "1 item" / "No items"
```

### Rich Text

```json
{
  "terms": "By signing up, you agree to our <terms>Terms</terms> and <privacy>Privacy Policy</privacy>."
}
```

```tsx
import { useTranslations } from 'next-intl';
import Link from 'next/link';

export function SignupTerms() {
  const t = useTranslations();
  
  return (
    <p>
      {t.rich('terms', {
        terms: chunks => <Link href="/terms">{chunks}</Link>,
        privacy: chunks => <Link href="/privacy">{chunks}</Link>,
      })}
    </p>
  );
}
```

## Navigation

### Localized Links

```tsx
import { Link } from '@/i18n/routing';

// Automatically includes locale prefix
<Link href="/products">Products</Link>
// → /es/products (if current locale is Spanish)
```

### Language Switcher

```tsx
"use client";
import { useLocale } from 'next-intl';
import { usePathname, useRouter } from '@/i18n/routing';
import { routing } from '@/i18n/routing';

export function LanguageSwitcher() {
  const locale = useLocale();
  const pathname = usePathname();
  const router = useRouter();

  const switchLocale = (newLocale: string) => {
    router.replace(pathname, { locale: newLocale });
  };

  return (
    <select value={locale} onChange={e => switchLocale(e.target.value)}>
      {routing.locales.map(loc => (
        <option key={loc} value={loc}>
          {loc.toUpperCase()}
        </option>
      ))}
    </select>
  );
}
```

### Programmatic Navigation

```tsx
"use client";
import { useRouter } from '@/i18n/routing';

export function ProductCard({ product }: { product: Product }) {
  const router = useRouter();
  
  const handleClick = () => {
    router.push(`/products/${product.id}`);  // Locale-aware
  };

  return <div onClick={handleClick}>{product.title}</div>;
}
```

## Formatting

### Numbers & Currency

```tsx
import { useFormatter } from 'next-intl';

export function PriceDisplay({ amount }: { amount: number }) {
  const format = useFormatter();
  
  return (
    <span>
      {format.number(amount, {
        style: 'currency',
        currency: 'USD',
      })}
    </span>
  );
  // en: $1,234.56
  // es: 1.234,56 US$
  // fr: 1 234,56 $US
}
```

### Dates & Times

```tsx
import { useFormatter } from 'next-intl';

export function DateDisplay({ date }: { date: Date }) {
  const format = useFormatter();
  
  return (
    <time dateTime={date.toISOString()}>
      {format.dateTime(date, {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })}
    </time>
  );
  // en: December 30, 2025
  // es: 30 de diciembre de 2025
  // fr: 30 décembre 2025
}

// Relative time
export function TimeAgo({ date }: { date: Date }) {
  const format = useFormatter();
  
  return <span>{format.relativeTime(date)}</span>;
  // "2 hours ago" / "hace 2 horas" / "il y a 2 heures"
}
```

### Lists

```tsx
import { useFormatter } from 'next-intl';

export function AuthorList({ authors }: { authors: string[] }) {
  const format = useFormatter();
  
  return <span>{format.list(authors, { type: 'conjunction' })}</span>;
  // en: "Alice, Bob, and Charlie"
  // es: "Alice, Bob y Charlie"
  // fr: "Alice, Bob et Charlie"
}
```

## Type Safety

### Generate Types

```ts
// types/i18n.d.ts
import en from '../messages/en.json';

type Messages = typeof en;

declare global {
  interface IntlMessages extends Messages {}
}
```

### Typed Hooks

```tsx
// Now TypeScript knows all valid keys
const t = useTranslations('products');
t('title');        // ✅ Valid
t('nonexistent');  // ❌ TypeScript error
```

## SEO

### Alternate Links

```tsx
// app/[locale]/layout.tsx
import { routing } from '@/i18n/routing';

export function generateMetadata({ params: { locale } }: Props) {
  return {
    alternates: {
      canonical: `/${locale}`,
      languages: Object.fromEntries(
        routing.locales.map(l => [l, `/${l}`])
      ),
    },
  };
}
```

### Sitemap

```tsx
// app/sitemap.ts
import { routing } from '@/i18n/routing';

export default async function sitemap() {
  const pages = ['', '/products', '/about'];
  
  return routing.locales.flatMap(locale =>
    pages.map(page => ({
      url: `https://example.com/${locale}${page}`,
      lastModified: new Date(),
      alternates: {
        languages: Object.fromEntries(
          routing.locales.map(l => [l, `https://example.com/${l}${page}`])
        ),
      },
    }))
  );
}
```

## Best Practices

1. **Namespace messages** by feature (products, auth, common)
2. **Use ICU message format** for plurals and complex logic
3. **Keep messages flat** when possible (avoid deep nesting)
4. **Extract strings early** — don't hardcode text
5. **Test RTL languages** (Arabic, Hebrew) if supported
6. **Validate message files** have same keys across languages
7. **Use professional translators** for production content